<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="utf-8" />
<title>迈优斯</title>
<link rel="shortcut icon" href="/mys/pc/resources/images/favicon.ico" type="image/x-icon" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1" name="viewport" />
<meta content="Preview page of Metronic Admin Theme #1 for statistics, charts, recent events and reports" name="description" />
<meta content="" name="author" />
<link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />
<link href="/mys/pc/resources/css/home_style.css" rel="stylesheet" type="text/css" />
<link href="/mys/pc/resources/js/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link href="/mys/pc/resources/js/plugins/assets/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="/mys/pc/resources/js/easyui/easyui_add.css" />
<link href="/mys/pc/resources/js/easyui/easyuiNew.css" rel="stylesheet" type="text/css" />
<!-- 项目样式文件 -->
<link href="/mys/pc/resources/css/public_style.css" rel="stylesheet" type="text/css" />
<!-- icon图标 -->
<link href="/mys/pc/resources/js/plugins/assets/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
<link rel="shortcut icon" href="favicon.ico" />

<!-- 杂七杂八 -->
<link href="/mys/pc/resources/js/plugins/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.min.css" rel="stylesheet" type="text/css" />
<link href="/mys/pc/resources/js/plugins/assets/global/plugins/morris/morris.css" rel="stylesheet" type="text/css" />
<link href="/mys/pc/resources/js/plugins/assets/global/plugins/fullcalendar/fullcalendar.min.css" rel="stylesheet" type="text/css" />
<link href="/mys/pc/resources/js/plugins/assets/global/plugins/jqvmap/jqvmap/jqvmap.css" rel="stylesheet" type="text/css" />
<link href="/mys/pc/resources/js/plugins/assets/global/css/components.min.css" rel="stylesheet" id="style_components" type="text/css" />
<link href="/mys/pc/resources/js/plugins/assets/global/css/plugins.min.css" rel="stylesheet" type="text/css" />
<link href="/mys/pc/resources/js/plugins/assets/layouts/layout/css/layout.min.css" rel="stylesheet" type="text/css" />
<link href="/mys/pc/resources/js/plugins/assets/layouts/layout/css/themes/darkblue.min.css" rel="stylesheet" type="text/css" id="style_color" />
<link href="/mys/pc/resources/js/plugins/assets/layouts/layout/css/custom.min.css" rel="stylesheet" type="text/css" />

<style>
.yiz-slider-1 {
	width: 100%;
	height: 100%;
	position: relative;
	top: 0;
	overflow: hidden
}

.pic {
	list-style: none;
	height: 100%;
	padding-left: 0;
}

.pic li {
	position: absolute;
	top: 0;
	left: 0;
	display: none;
}

.pic li img {
	width: 100%;
	height: 90%
}

.panel-title {
	color: #fff;
	line-height:15px;
}
.panel-header{
	height:30px;
	background:#0eb3b3;
}
</style>
</head>
<body>
	<!-- 公用导航栏 -->
	<!-- home_foot_wrap home_head_wrap-->
	<div class="home_foot  home_head_wrap">
		<ul class="list-inline" id="menu_wrap_home">
			<!-- <li class="nav-item action center_f color_f" onclick=goToHide("工作台");>
      	<i class="icon-home icon_style"></i>
      	<span class="title">工作台</span>
      	</li> -->
		</ul>
	</div>

	<!-- 右上角菜单图标 -->
	<div class="site-assistant nav_right">
		<div class="nav_right_wrap" id="r_menu_btn">
			<span class="glyphicon glyphicon-list" style="line-height: 70px"></span>
		</div>
		<ul class="list-unstyled" id="r_menu_c" style="display: none; margin-top: 2px">
			<li onclick=logout()><span class="icon-logout"></span><br>退出系统</li>
			<li onclick=editPassword()><span class="icon-lock"></span><br>密码修改</li>
			<!-- <li><span class="icon-logout"></span><br>系统设置</li> -->
		</ul>
	</div>
	<!-- <i class="glyphicon glyphicon-list nav_right"  id="right_btn" onclick=getRightMenu()></i> -->

	<!-- 子页面容器 -->
	<div class="home_bg home_wrap" id="home_head_wrap">
		<div class="easyui-layout noeasyui_wrap" id="easyui_w" style="width: 100%; height: 100%;">
			<div data-options="region:'west',split:true" id="second_nav" title="业务菜单" style="width: 200px; border-right: none; padding: 0 !important;background:#8dd6d6"></div>
			<div class="content_info_wrap" data-options="region:'center',title:'',iconCls:''">
				<div class="wrap_paddin info_wrap_content" id="info_wrap_content">
					<!-- 添加状态 -->
					<div id="maintab" class="easyui-tabs"></div>
				</div>
			</div>
		</div>
	</div>

	<script src="/mys/pc/resources/js/plugins/assets/global/plugins/jquery.min.js" type="text/javascript"></script>
	<script src="/mys/pc/resources/js/picAnimat/jquery.FainPic.js" type="text/javascript"></script>
	<script type="text/javascript" src="/mys/pc/resources/js/easyui/jquery.min.js"></script>
	<script type="text/javascript" src="/mys/pc/resources/js/bootstrap/bootstrap.min.js"></script>
	<script type="text/javascript" src="/mys/pc/resources/js/easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="/mys/pc/resources/js/easyui/easyui-lang-zh_CN.js"></script>
	<script type="text/javascript" src="/mys/pc/resources/js/Faith.js"></script>

	<!-- 项目公共js -->
	<script type="text/javascript" src="/mys/pc/resources/js/common.js"></script>
	<script type="text/javascript">
	var menudata=[];
	var rollpageSwitch=false;
	var depts=[];

  	$(function(){
  		//获取用户信息
  		getUser();
  		
  		//当多个单位时选择
  		if(depts.length>1){
 			/* selectRole(); */
 			/* 如果存在多个单位添加按钮 */
 			$("#r_menu_c").append('<li onclick=selectRole()><span class="icon-users"></span><br>选择单位</li>')
 		} 
  		
  		//根据角色进入工作台
  		/*
  		$.ajax({
  			url:projectName+"/sys/webpage/desk",
  			type:'get',
  			async:false,
  			dataType:'json',
  			success:function(rs){
  				$("#easyui_w").layout("collapse", "west")
  				console.log(rs);
  				addTab("工作台", rs);
  			},
  			error:function(jqXHR, textStatus, errorThrown)
  			{
  				$.messager.alert('错误：'+textStatus);
  			}
  		}); 
  		*/
	
	 	//1.获取所有菜单数据
    	getAllMenu();
		
    	//2.初始化一级菜单
    	initFirstLevelMenu();
    
	    //触发右边更多按钮
	    $("#r_menu_btn").mouseover(function(){
	    	$(this).addClass("action_mouse");
	    	$("#r_menu_c").css("display","block");	
	    }).mouseout(function(){
	    	$(this).removeClass("action_mouse");
	    	setTimeout($("#r_menu_c").css("display","none"),500);
	    	$("#r_menu_c").mouseover(function(){
	    		$("#r_menu_btn").addClass("action_mouse");
	    		$(this).css("display","block");
	    	}).mouseout(function(){
	    		$("#r_menu_btn").removeClass("action_mouse");
	    		setTimeout($(this).css("display","none"),500);
	    	});
	    }); 
  	});
  	
  	//1.获取所有菜单数据
    function getAllMenu(){
  		$.ajax({
  			url:projectName+"/sys/permission/menu",
  			type:'get',
  			async:false,
  			dataType:'json',
  			success:function(rs){
  				if(rs.code==1){
  					menudata=rs.data;
  				}
  				else{
  					$.messager.alert(rs.message);
  				}
  			},
  			error:function(jqXHR, textStatus, errorThrown)
  			{
  				$.messager.alert('错误：'+textStatus);
  			}
  		}); 
   } 
  	
  	//2.初始化一级菜单
  	function initFirstLevelMenu()
  	{
			var menustr='';
   			$.each(menudata,function(i,item){
   				if(item.parentId==0){
   					//判断名称是否是系统管理---填充不同的位置
   					if(item.resName!="系统管理"){
	   					menustr+='<li class="nav-item action center_f color_f firstlevel" data-id="'+item.resId+'" title='+item.resName+' url="'+item.resURL+'" >';
	      				menustr+='<i class="'+item.resIcon+' icon_style"></i>';
	      				menustr+='<span class="title">'+item.resName+'</span>';
	      				menustr+='</li>';
      				}else{ 
      					var li=$('<li  title='+item.resName+' url="'+item.resURL+'"><span class="icon-settings"></span><br>'+item.resName+'</li>'); 
	      				$("#r_menu_c").append(li);
	      				li.on('click',function(){
	      				//页面翻转动画
	       					if(!rollpageSwitch)
	       					{
	       						rollPage('up');
	       					}
	      					$('#second_nav').html('');
		   					initNextMenu("second_nav",item.resId,1);  
		   					var w=$("#easyui_w").layout("panel", "west")[0].clientWidth;
	   			     		if(w<=0){
	   			     			$("#easyui_w").layout('expand','west');
	   			    		} 
	      				}); 
      				}
   				}
   			});
   			$("#menu_wrap_home").append(menustr);
   			
   			//给一级菜单绑定点击事件
   			$('.firstlevel').each(function(i,item){
   				var resId=$(item).attr('data-id');
   				var url=$(item).attr('url');
   				var title=$(item).attr('title');
   				$(item).on('click',function(){
   					//页面翻转动画
   					if(!rollpageSwitch)
   					{
   						rollPage('up');
   					}
   					
   					//判断layout左边栏是否展开
   				  	if(url!=null && url!="null" && url!="" && url!="#"){ 
   			     		$("#easyui_w").layout('collapse','west');
   			     		if(url.indexOf('?')>0){
   			     			url=url+"&resId="+resId;
   			     		}
   			     		else{
   			     			url=url+"?resId="+resId;
   			     		}
   			     		addTab(title, url);  //如果一级菜单有Url  要添加tab
   			     	}
   			     	else  {
   			     		var w=$("#easyui_w").layout("panel", "west")[0].clientWidth;
   			     		if(w<=0){
   			     			$("#easyui_w").layout('expand','west');
   			    		}   
   			     		
   					}  
   				    //加载下级菜单
   				    $('#second_nav').html('');
   					initNextMenu("second_nav",resId,1); 
   				}); 
   			}); 
  	}
  	
  	
  	//3.加载下级菜单   target：目标容器  ； redId：当前菜单id  ；  level：层级
  	function initNextMenu(target,resId,level)
    {  
  		var ul=$('<ul class="list-unstyled nav_second_level nav_'+level+'"></ul>'); 
  		if(level==1){
  			$("#"+target).append(ul); 
  		}
  		else{
  			$("#"+target).after(ul); 
  		} 
  		$.each(menudata,function(i,item){
     		if(item.parentId==resId){    
     			//构造li 
     			var li=$('<li id="menu_'+item.resId+'" ><i class="'+item.resIcon+'" ></i><span style="margin-left:3px;">'+item.resName+'</span></li>'); 
     			var up_down_icon=$('<span class="fa"></span>'); 
     			ul.append(li); 
     			 
     			if(isNext(item.resId)){
     				li.append(up_down_icon);
     				up_down_icon.addClass('fa-angle-down');
     			} 
     			//li的点击事件
     			li.on('click',function(){
     				if(li.next().is('ul'))
   					{
     					if(li.next().is(':hidden')){
     						li.siblings('li').next('ul').hide();
     						li.next().show(); 
     						//图标动画
     						$('.fa',li).removeClass('fa-angle-down').addClass('fa-angle-up');
     					}
     					else{
     						li.next().hide(); 
     						//图标动画
     						$('.fa',li).removeClass('fa-angle-up').addClass('fa-angle-down');
     					} 
   					}
     				else{
     					initNextMenu("menu_"+item.resId,item.resId,level);
     					//图标动画
 						$('.fa',li).removeClass('fa-angle-down').addClass('fa-angle-up');
     				}
     				
     				//判断是否添加tab
     				if(item.resURL && item.resURL!=""&&item.resURL!="#"){  
     					var url=item.resURL;
     					if(url.indexOf('?')>0){
   			     			url=url+"&resId="+item.resId;
   			     		}
   			     		else{
   			     			url=url+"?resId="+item.resId;
   			     		}
   			     		addTab(item.resName, url);  
   			     	} 
     			}); 
     		}
     	});  
  		level++; 
  		if(ul.children().length==0)
  		{
  			ul.remove();
  		}	 
    }
  	
  	//判断是否有下级菜单
  	function isNext(resId)
  	{
  		var rs=false;
  		$.each(menudata,function(i,item){
  			if(item.parentId==resId){     
  				rs=true
  				return false;
  			}
  		});
  		return rs;
  	}
  	
  	//页面翻转动画
  	function rollPage(direction)
  	{
  		if(direction=='up')
  		{
  			 $("#home_wrap").animate({height:0},100,function(){
  	  	   	 	$(".home_foot").animate({top:0},700,function(){
  	  	   	 	    //菜单样式改变
  	  	   	 		$(".home_foot").removeClass("home_foot_wrap").addClass("home_head_wrap");
  	  	   	 		//右上角菜单添加返回首页菜单
  	  				if($("#r_menu_c").find(".r_m").length<1){
  	  					$back=$('<li class="r_m"><span class="icon-home"></span><br>返回主页</li>');
  	  					$("#r_menu_c").prepend($back);
  	  					$back.on('click',function(){
  	  						rollPage('down');
  	  					}); 
  	  				} 
  	  	   	 	});
  	  	   	 });
  			rollpageSwitch=true;
  		}
  		
  		if(direction=='down')
  		{
  			var bodyH=document.body.clientHeight
  	      	 $("#home_wrap").animate({height:"100%"},100,function(){
  	      	 	$(".home_foot").animate({top:bodyH-150},700,function(){
  	      	 		$(".home_foot").removeClass("home_head_wrap").addClass("home_foot_wrap");
  	      	 		//remove返回首页菜单
  	      	 		$("#r_menu_c").find(".r_m").remove();
  	      	 	});
  	      	 });
  			rollpageSwitch=false;
  			 
  		}	 
  	}
  	 
   
     var tab;
     //tab标签
     function addTab(title, url) {
        	<!-- var h=$('.page-content').height()-40; -->
        	var bodyH=document.body.clientHeight;
        	var headH=60;  //$(".home_foot").height();
        	var tabs_H=29; //$(".tabs-header").height()+2;
        	var h=bodyH-headH-tabs_H;
        	
        	if(!tab){
        		tab=$("#maintab").tabs({width:'100%'});
        	}
        	 
        	if(url!="null" && url!=""){
	            if ($("#maintab").tabs('exists', title)) {
	                $("#maintab").tabs('select', title);
	                var selTab = $('#maintab').tabs('getSelected');
	                // var url = $(selTab.panel('options').content).attr('src');
	                var content = '<iframe src="'+projectName+url+'"  style="height:'+h+'px;margin-top:2px;width:100%;border:0;" ></iframe>';
	                $('#maintab').tabs('update', {//如果标签存在，就刷新页面
	                    tab: selTab,
	                    options: {
	                        content: content
	                    }
	                });  
	            } else { 
	               var content = '<iframe src="'+projectName+url+'"  style="height:'+h+'px;margin-top:2px;width:100%;border:0;" ></iframe>';
	                if(title=="工作台"){
	                	$("#maintab").tabs('add', {
	                        title: title,
	                        content: content, 
	                       width:800,
	                        closable: false
	                    });
	                }else{
	                	$("#maintab").tabs('add', {
	                        title: title,
	                        content: content, 
	                        width:800,
	                        closable: true
	                    });
	                }    
	            }
        	}
        }
     //选择单位
     function selectRole(){
    	 var options={
     			formpage:'./webpage/selectOpet.html',
     			width:500,
     			height:250,
     			title:"选择操作"
     		 }
     		if(depts.length>1){
     			Faith.openForm(options);
     		}
     }
     
     function getUser(){
    	 $.ajax({
   			url:Faith.projectName+'/login/user',
   			type:'post',
   			async:false,
   			dataType:'json',
   			success:function(rs){
   				$.extend(Faith.currentUser,rs);
   	     		depts=rs.depts;
   	     		$(".ph_w").remove();
   	     		var usrStr='<div class="ph_w">';
   	     		usrStr+='<b><i class="icon-login" id="iconswith"></i></b>';
   	     		usrStr+='<b style="margin-left:15px"><i class="icon-user"></i><span  style="margin-left:5px">'+rs.nickName+'</span></b>';
   	     		usrStr+='<b style="margin-left:15px"><i class="icon-layers"></i>';
   	     		usrStr+='<span style="margin-left:5px">'+rs.dept.deptName+'</span>' 
   	     		usrStr+=''
   	     		usrStr+='</div>';
   	     		$("body").append(usrStr);
   	     		var on_off=true;
   	     		$(".ph_w").on("click",function(){
   	     			var _thisW=this.clientWidth;
   	     			if(on_off){
   	     				this.style.right = -(_thisW - 25);
   	     				$("#iconswith").removeClass("icon-login");
   	     				$("#iconswith").addClass("icon-logout");
   	     				on_off=false;
   	     			}else{
   	     				this.style.right = 0;
   	     				$("#iconswith").removeClass("icon-logout");
	     				$("#iconswith").addClass("icon-login");
   	     				on_off=true;
   	     			}
   	     		})
   			},
   			error:function(jqXHR, textStatus, errorThrown)
   			{
   				$.messager.alert('错误：'+textStatus);
   			}
   		});  
     }
   
   //退出系统
	function logout(){
		$.messager.confirm('提示', '确定要退出系统吗?', function(r){
			if (r){
				$.get(projectName+'/logout',{},function(rs){
					location.reload();
				},'text');
			}
		});
	};
	
	//修改密码
	function editPassword(){
		var options={title:'修改密码',formpage:"./webpage/password.html"};
		Faith.openForm(options);
	}
</script>
</body>
</html>